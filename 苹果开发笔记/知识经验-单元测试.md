

# 单元测试

## 相关术语
白盒测试：是通过程序的源代码进行测试而不使用用户界面。这种类型的测试需要从代码句法发现内部代码在算法，溢出，路径，条件等等中的缺点或者错误，进而加以修正。
黑盒测试：是通过使用整个软件或某种软件功能来严格地测试, 而并没有通过检查程序的源代码或者很清楚地了解该软件的源代码程序具体是怎样设计的。
灰盒测试：灰盒测试，是介于白盒测试与黑盒测试之间的，可以这样理解，灰盒测试关注输出对于输入的正确性，同时也关注内部表现，但这种关注不象白盒那样详细、完整，只是通过一些表征性的现象、事件、标志来判断内部的运行状态，有时候输出是正确的，但内部其实已经错误了，这种情况非常多，如果每次都通过白盒测试来操作，效率会很低，因此需要采取这样的一种灰盒的方法。

测试驱动开发：设计单元测试用例 → 编写单元测试程序 → 程序编码 → 单元测试 → 出具单元测试报告
测试用例：一组条件和场景，根据它来确定程序的正确性
断言：编写代码时，我们总是会做出一些假设，断言就是用于在代码中捕捉这些假设。

测试按阶段划分为：单元测试、集成测试、系统测试、回归测试
单元测试：测试对象是软件设计的最小单位--模块，是一种白盒测试

应用测试：是对整个应用程序进行的测试；创建工程时会自动创建；可以在模拟器或真机上运行；加载时间长，需要加载整个应用；没有scheme
逻辑测试：轻量级的，只测试某个业务逻辑对象的方法或算法的正确性；通过Target创建；只能在模拟器上运行；加载时间短，只需加载被测试类；会生成一个scheme

基于测试驱动的单元测试是迭代式的
如果使用测试框架进行测试，以test开头是必须的，框架根据这个条件判断哪些是测试方法，哪些是普通方法


## 分层设计中的单元测试

严格上来说每个方法需要有多个测试用例，可以把粒度放大到一个方法只有一个测试用例

表示层
逻辑测试—XCTest
业务逻辑层层的静态库Membership关联到target，而数据持久层的静态库不用，因为使用业务逻辑层的静态库时会把数据持久层的静态库一起复制到编译环境
伪对象：导入OCMock—修改User Header Search Paths修改为$(BUILT_PRODUCTS_DIR)
应用测试—只用伪对象（注：要把逻辑测试target升级为应用测试target（修改编译参数Bundle loader、Test Host））

业务逻辑层—XCTest
只做逻辑测试
例如业务逻辑层依赖数据持久层，则需要设置User Header Search Paths（用于指定用户提供类库的头文件的搜索路径）和Library Search Paths（用于设定类库搜索路径），如下：
User Header Search Paths修改为$(BUILT_PRODUCTS_DIR)
Library Search Paths清除原来的内容

数据持久层—XCTest
只做逻辑测试
实体类只有一些属性，这种类不需要进行测试
如果方法之间有依赖关系，测试方法的顺序也很重要

## 测试规范
注意测试边界条件，例如[1,100]，至少准备-1，0，50，100，101这些测试用例

************************************************************************************************************************************************
************************************************************************************************************************************************


手动创建测试程序


1、设计单元测试用例
	制定一组模拟数据
2、编写单元测试程序
	2.1、把程序的大致模型建立好，具体方法的实现可以先不写
	2.2、创建测试用target-xxxTest
			2.2.1、选择空程序，删除AppDegelate类
			2.2.2、创建Test类，导入要测试的类.h，书写初始化资源、释放资源、测试方法（模拟输入假数据，输出判断信息）
			2.2.3、修改target的main.m，把AppDegelate的有关代码去掉；初始化Test类对象，调用相关方法
			2.2.3、要测试的类.m—文件检查器—Target Membership—target打勾
3、选择测试用target进行测试、出具测试报告


************************************************************************************************************************************************
************************************************************************************************************************************************

# XCTest

## 简介
xcode5后自带
可进行逻辑测试及应用测试


## 单元测试/UI测试
新建target - Unit Testing Bundle / UI Testing Bundle

创建后会自动生成一个继承于XCTestCase类的xxx.m文件，相当于测试用例，可以删除
或者创建多个case（新建file - Unit Test Case Class / UI Test Case Class）

测试target去掉自动签名管理，然后在build setting - Signing - Code Signing identity选择开发者
单元测试，Provisioning Profile选none；UI测试，Provisioning Profile选对应的

command+u运行，也可以点击测试方法旁边的小图标运行


## 其他
Membership无需把被测试类关联测试类

## 参考网站
http://blog.csdn.net/icetime17/article/details/49893847
http://wenku.baidu.com/link?url=m5xjJ8CVYa6gRBKxUAujqJ1T5qcIHpAd3IBI3brsSUdssQ2TltFMnYM7FYt0_x5ac6XNNgFdSrt1IlOo7juWHb1x-zkNQ5Isi8yv2QqUHv7




************************************************************************************************************************************************
************************************************************************************************************************************************

# 代码覆盖率
http://www.jianshu.com/p/f4ba532caed0
如果要上生产环境，切忌将配置一定要关掉在从新打包上传，否则后患无穷



************************************************************************************************************************************************
************************************************************************************************************************************************

GHUnit

第三方框架
只能做逻辑测试

使用步骤：
target—空项目
到https://github.com/gh-unit/gh-unit/downloads下载框架，导入到target，还要导入QuartzCore框架
Other Linker Flags添加-Objc、-all_load；确保Framework Search Paths中已包含了GHUnitIOS.framework所在的路径
删除target中的AppDelegate类，修改main.m中的AppDelegate对象为@"GHUnitIOSAppDelegate"
被测试类的.m文件—文件检查器—Membership—target打勾（使他能够编译到所有的target中）


注：setUpClass/tearDownClass方法在整个测试生命周期只调用1次


************************************************************************************************************************************************
************************************************************************************************************************************************

伪对象

OCMock

对于一些不容易构造或不容易获取的对象，此时你可以创建一个虚拟的对象（mock object）来完成测试。

流程：创建伪对象—设置伪对象状态-设置伪对象中的期望值—将伪对象作为参数调用逻辑方法—验证伪对象的一致性

使用步骤：
到http://ocmock.ory下载OCMock文件，把里面的给ios用的文件拖入工程
把静态库添加到工程中逻辑测试的target中，设置静态库的Membership关联到逻辑测试的target
header seaarch paths—添加${PROJECT_DIR}/OCMockiOS—选择recursive
创建测试类继承于XCTest—设置伪对象的状态和期望值—验证伪对象的一致性

************************************************************************************************************************************************
************************************************************************************************************************************************

自动化测试
macaca
Appuim
Calabash
