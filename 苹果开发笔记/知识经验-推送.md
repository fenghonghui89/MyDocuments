


# 友盟推送
## 对接流程
- 创建apns appid /apns cer / provision profile，并安装相应证书到本机
- 钥匙串 - 直接选择apns cer 不要选择下拉的密钥 - 导出p12 
- 友盟后台创建应用 - 点击应用进入到该应用配置页 - 点击消息推送 - 上传p12证书 - 完成

## 其他
如果后台发推送提示推送失败 单播提示token无效 可能描述文件有问题导致token被苹果拒绝 或者上传到后台的证书有问题

一般情况下生产环境的token要app上线后通过抓包才能拿到，但个别app在9.x 开发模式下拿到的token是生产环境的token，所以如果测试模式下发推送失败提示token无效，则可能是因为这个原因

关于IDFA
从2月初开始，Apple开始拒绝采集IDFA(identifier for advertising)而未集成任何广告服务的应用进入AppStore。
如果没有用到广告服务，则不能含有idfa
iOS5.0分享SDK里新浪含IDFA，删除adsupport.framework，idfa函数就不会被调用，没有用这个adsupport，就不会调用到idfa函数，就不会含IDFA。
检测是否含有idfa：cd到第三方sdk的目录，grep -r advertisingIdentifier .（别少了空格和最后那个点号）。友盟说这个方法不准，只要下载的是最新版本无idfa版sdk就不用在意这个






# 杂
app在前台 收到推送 触发回调
app在后台 收到推送 点击推送 触发回调
app在后台 收到推送 点击app图标 不触发回调
app未运行 收到推送 点击推送 触发回调
app未运行 收到推送 点击app图标 不触发回调


常用流程1（类似微信，参考MyIOSDevelopTest）
```
AppDelegate:
通过接口收取信息

没有开启系统推送 
  - 没有提示过开启，则提示
    - 点确定，则跳转到系统通知设置
    - 点取消，则忽略
  - 提示过，则忽略

已经开启系统推送
  - 点app icon，进入应用，不处理，通知不消失
  - 点通知，进入应用，不处理，通知消失

每次启动总是执行注册推送

设置页面:
提示用户通过系统推送开关控制接收推送，app只负责设置通知是否有声音和震动
```

常用流程2（可以由用户决定服务器是否发送推送，参考FCM）
```
AppDelegate:
第一次运行时，向用户获取通知授权
    - 允许，系统推送打开，服务器发送推送，本地作标识
    - 不允许，系统推送不打开，服务器不发送推送，本地作标识
设置标识是否第一次运行
检查是否在未启动的时候收到推送

设置页面:
检测到标识为”接收推送“
   - 检测没有打开系统推送，提示用户打开
   检测到标识为”不接收推送“
   - 不处理

按钮
打开接收推送
    - 检测没有打开系统推送，提示用户打开
    - 检测已经打开系统推送，则注册通知
   关闭接收推送
    - 注销推送
```
